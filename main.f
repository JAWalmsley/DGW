      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION X3(20,40),AHZ(50),ALPHA(20,40),TOTIZ(50),AK(20,40),
     1          FITHTA(20,40),RHO(20,40),FIZIN(50),DEFIN(50),BDEFIN(50),
     1          TGRAND(1001),BFIZ(20,40),BDEF(20,40),BDEFNT(20,40),
     1          FIZ(20,40),DEF(20,40),ZFIELD(50),DEFNET(20,40),
     1          HT(20,40),BDFINT(50),HFIP(50)
C     AHZ IS 2PI*R*HZ(r)    HZ IN AMP/CM   R IN CM
C     AHZ IS NUMBERICALLY EQUAL TO HZ IN OERSTEDS BECAUSR R=0.2CM AND 1AMP/CM=
C     4PI/10OERSTEDS BUT IT HAS DIMENSION OF AMPS
C     RHO IS FIELD ON AXIS IN OERSTEDS
C     COILNO=NO COIL TURNS
C     CALIB=NO MICROVOLT SEC/INCH
C     FACTOR=ACTUAL SLOPE/IDEAL SLOPE
C     HFIP IS FI0FIELD IN OERSTED (OR Z-CURRENT IN AMPS) WHERE PENETRATION
C     FIRST OCCURS IN INCREASING H
      COILNO=1050.0D0
      CALIB=50.0D0
      SIDEAL=3.7077D0
      SACT=3.10D0
      FACTOR=SACT/SIDEAL
      PI=3.1415926536D0
      HC1=0.65D0*138.0D0
      DO11  J=1,21
      AJJ=J*1.0D0
      AHZ(J)=(AJJ               )*140.5D0
      FIZIN(J)=PI*4.0D-02*AHZ(J)*1.0D-02
      DEFIN(J)=FIZIN(J)*COILNO/CALIB*FACTOR
      ARG=AHZ(J)
      BDEFIN(J)=UFNH(ARG)*DEFIN(J)
      BDFINT(J)=BDEFIN(J)-AJJ*SACT
      MMM=20
      DO10  K=1,MMM
      TOTIZ(K)=K*25.0D0
      ALPHA(J,K)=TOTIZ(K)/AHZ(J)
      CONST=ALPHA(J,K)
C     SOLUTION OF EQUATION J1(VAR)/J0(VAR)=CONST BY METHOD OF BISECTION
      IF(CONST-1.0D3)504,12,12
  504 X1=1.0D-10
      X2=2.4042D0
    4 X3(J,K)=(X1+X2)/2.0D0
      VAR=X3(J,K)
      IF(DABS((VAR-X1)/VAR)-0.5D-05)2,7,7
    7 IF(RATIOF(VAR,CONST))1,2,3
    1 X1=X3(J,K)
      GO TO 4
    3 X2=X3(J,K)
      GO TO 4
    2 AK(J,K)=X3(J,K)/0.2D0
C     END OF BISECTION SOLUTION
      FIZ(J,K)=(TOTIZ(K)/AK(J,K))*4.0D-03*PI
      DEF(J,K)=FIZ(J,K)*COILNO/CALIB*FACTOR
      DEFNET(J,K)=DEF(J,K)-AJJ*SACT
      Y=AK(J,K)*0.2D0
      RHO(J,K)=AHZ(J)/BESFUN(1,Y)
      FITHTA(J,K)=RHO(J,K)*1.6D0/AK(J,K)*(1.0D0-BESFUN(1,Y))*4.0D-03*PI
C     SIMPSONS RULE FOR CASE MU =/= 1
      NO=50
      HH=X3(J,K)/(2.0D0*NO)
      NTOP=2*NO+1
      DO900 I=1,NTOP
      RKR(X3(J,K)/(2.0D0*NO))*(I-1)
      TOTH=(BESFUN(1,RKR)**2+BESFUN(2,RKR)**2)**0.5D0*RHO(J,K)
      TGRAND(I)=UFNH(TOTH)*BESFUN(1,RKR)*RKR
  900 CONTINUE
      BFIZ(J,K)=TGRAND(1)
      DO901 LL=1,NO
      LL2=2*LL
      BFIZ(J,K)=BFIZ(J,K)+TGRAND(LL2)*4.0D0
  901 CONTINUE
      NOM1=NO-1
      DO902 MM=1,NOM1
      MM2=2*MM+1
      BFIZ(J,K)=BFIZ(J,K)+TGRAND(MM2)*2.0D0
  902 CONTINUE
      BFIZ(J,K)=(BFIZ(J,K)+TGRAND(NTOP))*HH/3.0D0
      BFIZ(J,K)=BFIZ(J,K)*4.0D-03*PI*5.0D0*RHO(J,K)/AK(J,K)**2
      BDEF(J,K)=BFIZ(J,K)*COILNO/CALIB*FACTOR
      BDEFNT(J,K)=BDEF(J,K)-AJJ*SACT
C     END OF SIMPSONS RULE
   10 CONTINUE
   12 ZFIELD(J)=AHZ(J)
      CURRM=ZFIELD(J)/140.5D0
      PRINT601,CURRM,ZFIELD(J)
  601 FORMAT(16HIMAGNET CURRENT=,D12.5,
     1                      4HAMPS,5X,7HZFIELD=,D12.5,8HOERSTEDS)
      IF(AHZ(J)-HC1)20,21,21
   20 HFIP(J)=DSQRT(HC1**2-AHZ(J)**2)
      PRINT 606,HFIP(J)
  606 FORMAT(21H PENETRATION CURRENT=D12.5,4HAMPS)
      GO TO 22
   21 PRINT607
  607 FORMAT(27H PENETRAION FIELD EXCEEDED)
   22 PRINT 605,FIZIN(J),DEFIN(J),BDEFIN(J),BDFINT(J)
  605 FORMAT(13H FIZ INITIAL=,D12.5,13HMICROVOLT-SEC,5X,12HDEF INITIAL=,
     1         D12.5,6HINCHES,5X,13HBDEF INITIAL=,D12.5,6HINCHES,5X,
     1          4HNET=,D12.5,2HIN)
      PRINT603
  603 FORMAT(1H0,3X,5HTOTIZ,7X,5HALPHA,9X,1HZ,11X,1HK,10X,3HFIZ,9X,
     1          3HDEF,9X,3HRH0,7X,6HDEFNET,8X,4HBFIZ,8X,4HBDEF,6X,
     1                   6HBDEFNT)
      DO604 K=1,MMM
      PRINT602,TOTIZ(K),ALPHA(J,K),X3(J,K),AK(J,K),FIZ(J,K),DEF(J,K)
     1           ,RHO(J,K),DEFNET(J,K),BFIZ(J,K),BDEF(J,K),BDEFNT(J,K)
  602 FORMAT(11D12.5)
  604 CONTINUE
   11 CONTINUE
      CALL EXIT
      END